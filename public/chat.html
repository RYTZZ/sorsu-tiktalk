<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SorSU TikTalk - Chat</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body data-theme="light">
    <div class="chat-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 class="app-title">TikTalk</h2>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-details">
                        <h4 id="userNickname">Anonymous</h4>
                        <span class="campus-badge" id="userCampusBadge">Campus</span>
                    </div>
                </div>
            </div>

            <div class="campus-list">
                <h3>Campus Rooms</h3>
                <div class="campus-item" data-campus="bulan">
                    <span>
                        <span class="campus-badge bulan">Bulan</span>
                    </span>
                    <span class="online-count" data-campus-online="bulan">0</span>
                </div>
                <div class="campus-item" data-campus="castilla">
                    <span>
                        <span class="campus-badge castilla">Castilla</span>
                    </span>
                    <span class="online-count" data-campus-online="castilla">0</span>
                </div>
                <div class="campus-item" data-campus="magallanes">
                    <span>
                        <span class="campus-badge magallanes">Magallanes</span>
                    </span>
                    <span class="online-count" data-campus-online="magallanes">0</span>
                </div>
                <div class="campus-item" data-campus="sorsogon-city">
                    <span>
                        <span class="campus-badge sorsogon-city">Sorsogon City</span>
                    </span>
                    <span class="online-count" data-campus-online="sorsogon-city">0</span>
                </div>
            </div>

            <div class="campus-list" style="border-top: 1px solid var(--border-color); padding-top: 1rem; margin-top: 1rem;">
                <h3>Direct Messages</h3>
                <div class="campus-item" id="newDMBtn" style="background: var(--accent-primary); color: white;">
                    <span>
                        ‚úâÔ∏è New Message
                    </span>
                    <span class="online-count" id="dmUnreadCount" style="background: var(--danger); display: none;">0</span>
                </div>
                <div id="dmList" style="max-height: 200px; overflow-y: auto;">
                    <!-- DM conversations will appear here -->
                </div>
            </div>

            <div class="campus-list" style="border-top: 1px solid var(--border-color); padding-top: 1rem; margin-top: 1rem;">
                <h3>Match Chat</h3>
                <div class="campus-item" id="matchChatBtn" style="background: linear-gradient(135deg, var(--accent-primary), var(--accent-hover)); color: white;">
                    <span>
                        üé≤ Find Random Match
                    </span>
                </div>
                <div class="match-status hidden" id="matchStatus">
                    <div style="padding: 0.875rem 1rem; font-size: 0.85rem; color: var(--text-secondary);">
                        <span id="matchStatusText">Searching...</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="main-chat">
            <header class="chat-header">
                <div>
                    <h2 class="chat-title" id="chatTitle">Select a Campus</h2>
                </div>
                <div class="header-actions">
                    <button class="icon-btn" id="notificationBtn" title="Notifications" style="position: relative;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span id="notificationBadge" class="notification-badge hidden">0</span>
                    </button>
                    <button class="icon-btn" id="menuBtn" title="Menu">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                    <div class="theme-toggle" id="themeToggle" title="Toggle dark mode"></div>
                    <button class="icon-btn" id="logoutBtn" title="Logout">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </header>

            <div class="messages-container" id="messagesContainer">
                <div class="text-center" style="color: var(--text-muted); padding: 2rem;">
                    Select a campus to start chatting
                </div>
            </div>

            <div class="typing-indicator hidden" id="typingIndicator"></div>

            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea 
                        id="messageInput" 
                        class="chat-input" 
                        placeholder="Type your message..." 
                        rows="1"
                        maxlength="500"
                    ></textarea>
                    <button class="send-btn" id="sendBtn" disabled>Send</button>
                </div>
                <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">
                    <span id="charCount">0</span>/500 characters
                </div>
            </div>
        </main>
    </div>

    <!-- Report Modal -->
    <div class="modal-overlay hidden" id="reportModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Report Message</h3>
                <button class="close-btn" id="closeReportModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Reason for Report</label>
                    <select id="reportReason" class="form-select">
                        <option value="">Select a reason</option>
                        <option value="harassment">Harassment/Bullying</option>
                        <option value="hate-speech">Hate Speech</option>
                        <option value="spam">Spam</option>
                        <option value="sexual-content">Sexual Content</option>
                        <option value="threatening">Threatening Behavior</option>
                        <option value="impersonation">Impersonation</option>
                        <option value="misinformation">Misinformation</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Additional Details (Optional)</label>
                    <textarea 
                        id="reportDetails" 
                        class="form-input" 
                        rows="3" 
                        maxlength="300"
                        placeholder="Provide context for your report..."
                    ></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelReport">Cancel</button>
                <button class="btn btn-danger" id="submitReport">Submit Report</button>
            </div>
        </div>
    </div>

    <!-- Banned Modal -->
    <div class="modal-overlay hidden" id="bannedModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Account Banned</h3>
            </div>
            <div class="modal-body" id="bannedMessage">
                <p>You have been banned from SorSU TikTalk.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="window.location.href='/'">OK</button>
            </div>
        </div>
    </div>

    <!-- Match Type Selection Modal -->
    <div class="modal-overlay hidden" id="matchTypeModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Choose Match Type</h3>
                <button class="close-btn" id="closeMatchTypeModal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
                    Choose who you want to match with for anonymous 1-on-1 chat
                </p>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <button class="btn btn-primary" id="matchSameCampus" style="padding: 1.5rem; font-size: 1.1rem;">
                        üè´ Same Campus Only
                        <div style="font-size: 0.85rem; font-weight: normal; margin-top: 0.5rem; opacity: 0.9;">
                            Match with someone from <span id="userCampusName"></span>
                        </div>
                    </button>
                    <button class="btn btn-primary" id="matchAnyCampus" style="padding: 1.5rem; font-size: 1.1rem; background: linear-gradient(135deg, #9C27B0, #E91E63);">
                        üåç Any Campus
                        <div style="font-size: 0.85rem; font-weight: normal; margin-top: 0.5rem; opacity: 0.9;">
                            Match with anyone from SorSU
                        </div>
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelMatchType">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Match Chat Interface -->
    <div class="modal-overlay hidden" id="matchChatModal">
        <div class="modal" style="max-width: 700px; max-height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span id="matchChatTitle">Match Chat</span>
                    <span style="font-size: 0.75rem; font-weight: normal; color: var(--text-muted); margin-left: 0.5rem;" id="matchPartnerInfo"></span>
                </h3>
                <button class="close-btn" id="closeMatchChat">&times;</button>
            </div>
            
            <!-- Searching State -->
            <div id="matchSearching" class="modal-body" style="text-align: center; padding: 3rem;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
                <h3 style="margin-bottom: 0.5rem;">Searching for a match...</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    <span id="searchingText">Looking for someone to chat with</span>
                </p>
                <button class="btn btn-secondary" id="cancelMatchSearch">Cancel Search</button>
            </div>

            <!-- Chat State -->
            <div id="matchChatContent" class="hidden" style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
                <div style="padding: 1rem; background: var(--bg-secondary); border-bottom: 1px solid var(--border-color);">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">
                                Connected with: <span style="color: var(--accent-primary);">Anonymous User</span>
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                From: <span id="partnerCampusDisplay">Loading...</span>
                            </div>
                        </div>
                        <button class="btn btn-danger" id="reportMatchPartner" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                            üö© Report
                        </button>
                    </div>
                </div>

                <div class="messages-container" id="matchMessages" style="flex: 1; overflow-y: auto; padding: 1.5rem; min-height: 300px;">
                    <div class="text-center" style="color: var(--text-muted); padding: 2rem;">
                        Start chatting! Remember to be respectful.
                    </div>
                </div>

                <div class="typing-indicator hidden" id="matchTypingIndicator" style="padding: 0.5rem 1.5rem; font-size: 0.85rem; color: var(--text-muted); font-style: italic;">
                    Partner is typing...
                </div>

                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea 
                            id="matchInput" 
                            class="chat-input" 
                            placeholder="Type your message..." 
                            rows="1"
                            maxlength="500"
                        ></textarea>
                        <button class="send-btn" id="sendMatchBtn" disabled>Send</button>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                        <div style="font-size: 0.75rem; color: var(--text-muted);">
                            <span id="matchCharCount">0</span>/500 characters
                        </div>
                        <button class="btn btn-danger" id="leaveMatch" style="padding: 0.25rem 0.75rem; font-size: 0.75rem;">
                            Leave Match
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Match Partner Modal -->
    <div class="modal-overlay hidden" id="reportMatchModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Report Match Partner</h3>
                <button class="close-btn" id="closeReportMatchModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Reason for Report</label>
                    <select id="reportMatchReason" class="form-select">
                        <option value="">Select a reason</option>
                        <option value="harassment">Harassment/Bullying</option>
                        <option value="hate-speech">Hate Speech</option>
                        <option value="spam">Spam</option>
                        <option value="sexual-content">Sexual Content</option>
                        <option value="threatening">Threatening Behavior</option>
                        <option value="impersonation">Impersonation</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Additional Details (Optional)</label>
                    <textarea 
                        id="reportMatchDetails" 
                        class="form-input" 
                        rows="3" 
                        maxlength="300"
                        placeholder="Describe what happened..."
                    ></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelReportMatch">Cancel</button>
                <button class="btn btn-danger" id="submitReportMatch">Submit Report</button>
            </div>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div class="modal-overlay hidden" id="notificationsPanel">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Notifications</h3>
                <button class="close-btn" id="closeNotifications">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                <div id="notificationsList">
                    <div class="text-center" style="padding: 2rem; color: var(--text-muted);">
                        No notifications
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="clearNotifications">Clear All</button>
            </div>
        </div>
    </div>

    <!-- New DM - User Selection Modal -->
    <div class="modal-overlay hidden" id="newDMModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">New Direct Message</h3>
                <button class="close-btn" id="closeNewDM">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Select User</label>
                    <input type="text" id="dmUserSearch" class="form-input" placeholder="Search users...">
                </div>
                <div id="onlineUsersList" style="max-height: 300px; overflow-y: auto; margin-top: 1rem;">
                    <!-- Online users will appear here -->
                </div>
            </div>
        </div>
    </div>

    <!-- DM Chat Window -->
    <div class="modal-overlay hidden" id="dmChatModal">
        <div class="modal" style="max-width: 700px; max-height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span id="dmChatTitle">Direct Message</span>
                </h3>
                <button class="close-btn" id="closeDMChat">&times;</button>
            </div>
            
            <div style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
                <div class="messages-container" id="dmMessages" style="flex: 1; overflow-y: auto; padding: 1.5rem; min-height: 300px;">
                    <div class="text-center" style="color: var(--text-muted); padding: 2rem;">
                        Start your conversation
                    </div>
                </div>

                <div class="typing-indicator hidden" id="dmTypingIndicator" style="padding: 0.5rem 1.5rem; font-size: 0.85rem; color: var(--text-muted); font-style: italic;">
                    Typing...
                </div>

                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea 
                            id="dmInput" 
                            class="chat-input" 
                            placeholder="Type your message..." 
                            rows="1"
                            maxlength="500"
                        ></textarea>
                        <button class="send-btn" id="sendDMBtn" disabled>Send</button>
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">
                        <span id="dmCharCount">0</span>/500 characters
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Emoji Picker Modal -->
    <div class="modal-overlay hidden" id="emojiPickerModal">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">React with Emoji</h3>
                <button class="close-btn" id="closeEmojiPicker">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.5rem;">
                    <button class="emoji-btn" data-emoji="üëç">üëç</button>
                    <button class="emoji-btn" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</button>
                    <button class="emoji-btn" data-emoji="üòÇ">üòÇ</button>
                    <button class="emoji-btn" data-emoji="üòÆ">üòÆ</button>
                    <button class="emoji-btn" data-emoji="üò¢">üò¢</button>
                    <button class="emoji-btn" data-emoji="üò°">üò°</button>
                    <button class="emoji-btn" data-emoji="üéâ">üéâ</button>
                    <button class="emoji-btn" data-emoji="üî•">üî•</button>
                    <button class="emoji-btn" data-emoji="üíØ">üíØ</button>
                    <button class="emoji-btn" data-emoji="üëè">üëè</button>
                    <button class="emoji-btn" data-emoji="üôè">üôè</button>
                    <button class="emoji-btn" data-emoji="‚ú®">‚ú®</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="/js/socket-client.js"></script>
    <script src="/js/chat.js"></script>
    <script src="/js/features.js"></script>
</body>
</html>
